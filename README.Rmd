---
title: "BFR"
date: "Last README update: `r format(Sys.Date())`"
output: github_document
---

**B**ayesian genomic **F**unctional **R**egression analysis in R - Development version 0.9 - rev 3

[![Release][release-badge]][cran]
[![License: LGPL v3][LGPL-badge]][LGPL]
[![Project Status: Active][status-bagde]][status]
[![Downloads][downloads-badge]][cran]

## New in this dev version
* Initial development is in progress, but there has not yet been a stable, usable release suitable for the public; this is a pre-release, be careful.

## Instructions for proper implementation

### Installation

To complete installation of dev version of BFR from GitHub, you have to install a few packages first.

```{r installation, eval = FALSE}
install.packages('devtools')
devtools::install_github('frahik/BFR')
```

### Quick use 

#### Load data

```{r loadData}
rm(list = ls())
library(BFR)
data("Wheat_BFR")

data <- Wheat_BFR # Load from data Wheat_BFR
Bands <- Wheat_Bands # Load from data Wheat_BFR
Wavelengths <- Wheat_Wavelengths # Load from data Wheat_BFR

data("Maize_BFR")
data <- Maize_BFR # Load from data Maize_BFR
Bands <- Maize_Bands # Load from data Maize_BFR
Wavelengths <- Maize_Wavelengths # Load from data Maize_BFR
```


#### Fit model

```{r fitModel}
data("Wheat_BFR")
data <- Wheat_BFR[which(Wheat_BFR$Env == 'Drought'), ]

fm <- BFR(data, nIter = 1000, burnIn = 300, verbose = F)

plot(fm)
```

### Cross-validation model with kfold

```{r CVModel}
data("Wheat_BFR")
data <- Wheat_BFR[which(Wheat_BFR$Env == 'Drought'), ]
Crossvalidation_list <- list(Type = 'KFold', nFolds = 3)

pm <- BFR(data, nIter = 1000, burnIn = 300, set_seed = 10, CrossValidation = Crossvalidation_list, verbose = F)
summary(pm)

boxplot(pm)
```

### Auto-detection of linear predictor (Only Environment)

```{r ETAG}
library(BFR)
data("Wheat_BFR")
CrossV <- list(Type = 'KFold', nFolds = 3)
ETA2 <- ETAGenerate(Wheat_BFR, datasetID = 'Line', priorType = 'BayesB', Bands = Wheat_Bands,
                    Wavelengths = Wheat_Wavelengths, method = 'Alternative', basisType = 'Bspline.Basis', nBasis = 21)


pm2 <- BFR(ETA = ETA2, data, nIter = 1000, burnIn = 300, set_seed = 10, CrossValidation = CrossV, verbose = F)
summary(pm2)

plot(pm2)
```

### Auto-detection of linear predictor (Multi-Trait & Multi-Environment)
```{r ETA_MTME}
data("Maize_BFR")
CrossV <- list(Type = 'RandomPartition', NPartitions = 5, PTesting = .25)
ETA3 <- ETAGenerate(Maize_BFR, basisType = 'Bspline.Basis', Bands = Maize_Bands, Wavelengths = Maize_Wavelengths, priorType = 'BRR', method = 'Simple', nBasis = 21)
ETA3$Design
ETA3$Basis
ETA3$Prior
ETA3$Method
pm3 <- BFR(ETA = ETA3, data, nIter = 1000, burnIn = 300, set_seed = 10, CrossValidation = CrossV, verbose = F)
summary(pm3)
```



### Handmade linear predictor
```{r ETAM}
CrossV <- list(Type = 'KFold', nFolds = 5)
ETA4 <- list(Env = list(X = model.matrix(~0+as.factor(Wheat_BFR$Env)), model = 'FIXED'),
             Line = list(X = model.matrix(~0+as.factor(Wheat_BFR$Line)), model = 'BRR'),
             Bands = list(X = Bspline.Basis(Wheat_Bands, Wheat_Wavelengths, nBasis = 23), model = 'BayesA'))
pm4 <- BFR(data = Wheat_BFR, ETA = ETA4, nIter = 1000, burnIn = 300, CrossValidation = CrossV, set_seed = 10, verbose = F)
summary(pm4)

plot(pm4, select = 'MSEP')
boxplot(pm4, select = 'MSEP')
```

```{r, echo=F, results='hide'}
path <- dir()
files <- path[which(grepl('.dat', path) == TRUE)]
file.remove(files)
```

## Citation

How to cite the package...
Coming soon.

## Issues

Feel free to report new issues in this link [Issues](https://github.com/frahik/IBCF.MTME/issues/new)


## Authors

 - Francisco Javier Luna-Vázquez (Author, Maintainer)
 - Osval Antonio Montesinos-López (Author)
 - Abelardo Montesinos-López (Author)
 - José Crossa (Author)


[LGPL-badge]: https://img.shields.io/badge/License-LGPL%20v3-blue.svg "LGPL, Version 2.0"
[status-bagde]: http://www.repostatus.org/badges/latest/wip.svg "status"
[downloads-badge]: http://cranlogs.r-pkg.org/badges/BFR "IBCF.MTME cranlogs"
[release-badge]: http://www.r-pkg.org/badges/version-ago/BFR "IBCF.MTME release"
[cran]: https://cran.r-project.org/package=BFR "CRAN Page"
[LGPL]: https://www.gnu.org/licenses/lgpl-3.0 "LGPL, Version 2.0"
[status]: http://www.repostatus.org/#wip "status - Initial development is in progress, but there has not yet been a stable, usable release suitable for the public"
